<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Boletería</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="src/assets/styles.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-ticket-alt me-2"></i>
                    TicketVue
                </a>
            </div>
        </nav>

        <!-- Progress Indicator -->
        <div class="container mt-4" v-if="currentStep > 1">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-center">
                            <div class="progress-step" :class="getStepClass(1)">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <small>Seleccionar Evento</small>
                        </div>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 3px;">
                                <div class="progress-bar" :style="{width: progressWidth + '%'}"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="progress-step" :class="getStepClass(2)">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <small>Seleccionar Entrada</small>
                        </div>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 3px;">
                                <div class="progress-bar" :style="{width: progressWidth >= 66 ? '100%' : '0%'}"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="progress-step" :class="getStepClass(3)">
                                <i class="fas fa-user"></i>
                            </div>
                            <small>Datos Personales</small>
                        </div>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 3px;">
                                <div class="progress-bar" :style="{width: progressWidth >= 100 ? '100%' : '0%'}"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="progress-step" :class="getStepClass(4)">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <small>Confirmación</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista 1: Lista de Eventos -->
        <div v-if="currentStep === 1">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="container text-center">
                    <h1 class="display-4 mb-4">¡Descubre Eventos Increíbles!</h1>
                    <p class="lead">Compra tu entrada de forma rápida y segura</p>
                </div>
            </div>

            <div class="container mt-5">
                <div class="row">
                    <div class="col-md-4 mb-4" v-for="event in events" :key="event.id">
                        <div class="card event-card h-100" @click="selectEvent(event)">
                            <img :src="event.image" class="card-img-top" :alt="event.name" style="height: 200px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ event.name }}</h5>
                                <p class="card-text flex-grow-1">{{ event.description }}</p>
                                <div class="mt-auto">
                                    <p class="card-text">
                                        <small class="text-muted">
                                            <i class="fas fa-calendar me-2"></i>{{ event.date }}
                                        </small>
                                    </p>
                                    <p class="card-text">
                                        <small class="text-muted">
                                            <i class="fas fa-map-marker-alt me-2"></i>{{ event.location }}
                                        </small>
                                    </p>
                                    <p class="card-text">
                                        <strong class="text-primary">Desde ${{ event.minPrice }}</strong>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista 2: Selección de Entradas -->
        <div v-if="currentStep === 2" class="container mt-5">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="mb-4">{{ selectedEvent.name }}</h2>
                    <p class="text-muted mb-4">{{ selectedEvent.description }}</p>
                    
                    <h4 class="mb-3">Selecciona tu entrada:</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3" v-for="ticket in selectedEvent.tickets" :key="ticket.id">
                            <div class="card ticket-option" 
                                 :class="{selected: selectedTicket && selectedTicket.id === ticket.id}"
                                 @click="selectTicket(ticket)">
                                <div class="card-body">
                                    <h5 class="card-title">{{ ticket.name }}</h5>
                                    <p class="card-text">{{ ticket.description }}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <strong class="text-primary h4">${{ ticket.price }}</strong>
                                        <span class="badge bg-secondary">{{ ticket.available }} disponibles</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Selector de Cantidad -->
                    <div v-if="selectedTicket" class="row mt-4">
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-shopping-cart me-2"></i>Cantidad de Entradas
                                    </h6>
                                    <div class="d-flex align-items-center">
                                        <button class="btn btn-outline-secondary btn-sm" @click="decreaseQuantity()" :disabled="ticketQuantity <= 1">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <span class="mx-3 fs-5 fw-bold">{{ ticketQuantity }}</span>
                                        <button class="btn btn-outline-secondary btn-sm" @click="increaseQuantity()" :disabled="ticketQuantity >= selectedTicket.available">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">Máximo {{ selectedTicket.available }} entradas disponibles</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-calculator me-2"></i>Cálculo Total
                                    </h6>
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>{{ ticketQuantity }} x ${{ selectedTicket.price }}</span>
                                        <span>${{ subtotal }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <strong>Total con servicios:</strong>
                                        <strong class="text-success">${{ totalAmount }}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" @click="goBack()">
                            <i class="fas fa-arrow-left me-2"></i>Volver
                        </button>
                        <button class="btn btn-primary" @click="proceedToPersonalData()" :disabled="!selectedTicket">
                            Continuar <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Resumen del Evento</h5>
                        </div>
                        <div class="card-body">
                            <img :src="selectedEvent.image" class="img-fluid rounded mb-3" :alt="selectedEvent.name">
                            <p><strong>Fecha:</strong> {{ selectedEvent.date }}</p>
                            <p><strong>Ubicación:</strong> {{ selectedEvent.location }}</p>
                            <div v-if="selectedTicket" class="mt-3 p-3 bg-light rounded">
                                <h6>Entrada Seleccionada:</h6>
                                <p class="mb-1">{{ selectedTicket.name }}</p>
                                <p class="mb-1"><strong>Cantidad:</strong> {{ ticketQuantity }}</p>
                                <div class="d-flex justify-content-between">
                                    <span>Subtotal:</span>
                                    <strong class="text-primary">${{ subtotal }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>+ Servicios:</span>
                                    <span>${{ serviceCharge }}</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <strong>Total:</strong>
                                    <strong class="text-success">${{ totalAmount }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista 3: Datos Personales -->
        <div v-if="currentStep === 3" class="container mt-5">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="mb-4">Datos Personales</h2>
                    <form @submit.prevent="processPayment()">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName" class="form-label">Nombre *</label>
                                <input type="text" class="form-control" id="firstName" v-model="personalData.firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName" class="form-label">Apellido *</label>
                                <input type="text" class="form-control" id="lastName" v-model="personalData.lastName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" v-model="personalData.email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Teléfono *</label>
                                <input type="tel" class="form-control" id="phone" v-model="personalData.phone" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="document" class="form-label">Documento de Identidad *</label>
                            <input type="text" class="form-control" id="document" v-model="personalData.document" required>
                        </div>
                        
                        <h4 class="mt-4 mb-3">Datos de Pago</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cardNumber" class="form-label">Número de Tarjeta *</label>
                                <input type="text" class="form-control" id="cardNumber" v-model="paymentData.cardNumber" 
                                       placeholder="1234 5678 9012 3456" maxlength="19" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cardName" class="form-label">Nombre en la Tarjeta *</label>
                                <input type="text" class="form-control" id="cardName" v-model="paymentData.cardName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expiry" class="form-label">Fecha de Vencimiento *</label>
                                <input type="text" class="form-control" id="expiry" v-model="paymentData.expiry" 
                                       placeholder="MM/AA" maxlength="5" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cvv" class="form-label">CVV *</label>
                                <input type="text" class="form-control" id="cvv" v-model="paymentData.cvv" 
                                       placeholder="123" maxlength="4" required>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-outline-secondary" @click="goBack()">
                                <i class="fas fa-arrow-left me-2"></i>Volver
                            </button>
                            <button type="submit" class="btn btn-success" :disabled="processing">
                                <span v-if="processing">
                                    <i class="fas fa-spinner fa-spin me-2"></i>Procesando...
                                </span>
                                <span v-else>
                                    Procesar Pago <i class="fas fa-credit-card ms-2"></i>
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="col-md-4">
                    <div class="ticket-summary">
                        <h5 class="text-white mb-3">Resumen de Compra</h5>
                        <div class="mb-2">
                            <strong>{{ selectedEvent.name }}</strong>
                        </div>
                        <div class="mb-2">
                            <small>{{ selectedEvent.date }} - {{ selectedEvent.location }}</small>
                        </div>
                        <hr class="bg-white">
                        <div class="d-flex justify-content-between mb-2">
                            <span>{{ selectedTicket.name }} x{{ ticketQuantity }}</span>
                            <span>${{ subtotal }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Cargos por servicio</span>
                            <span>${{ serviceCharge }}</span>
                        </div>
                        <hr class="bg-white">
                        <div class="d-flex justify-content-between">
                            <strong>Total:</strong>
                            <strong>${{ totalAmount }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista 4: Confirmación con QR -->
        <div v-if="currentStep === 4" class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <div class="alert alert-success" role="alert">
                        <i class="fas fa-check-circle fa-3x mb-3"></i>
                        <h3>¡Compra Exitosa!</h3>
                        <p>Tu entrada ha sido procesada correctamente.</p>
                    </div>

                    <div class="card mt-4">
                        <div class="card-body">
                            <h4 class="card-title mb-4">Tu Entrada Digital</h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- QR del Código de Entrada -->
                                    <div class="text-center mb-4">
                                        <h5 class="mb-3">Código QR de Entrada</h5>
                                        <div class="qr-container d-flex justify-content-center">
                                            <div id="qrTicketCode"></div>
                                        </div>
                                        <p class="mt-3"><strong>Código de Entrada:</strong></p>
                                        <code class="fs-5 bg-light p-2 rounded d-block">{{ ticketCode }}</code>
                                        <small class="text-muted mt-2 d-block">Presenta este código QR en la entrada del evento</small>
                                    </div>
                                </div>
                                <div class="col-md-6 text-start">
                                    <h5 class="mb-3">Detalles del Evento</h5>
                          <p><strong>Evento:</strong> {{ selectedEvent.name }}</p>
                          <p><strong>Fecha:</strong> {{ selectedEvent.date }}</p>
                          <p><strong>Ubicación:</strong> {{ selectedEvent.location }}</p>
                          <p><strong>Tipo de Entrada:</strong> {{ selectedTicket.name }}</p>
                          <p><strong>Cantidad:</strong> {{ ticketQuantity }} entrada(s)</p>
                          <p><strong>Total Pagado:</strong> ${{ totalAmount }}</p>                                    <hr>
                                    <h5 class="mb-3">Datos del Comprador</h5>
                                    <p><strong>Nombre:</strong> {{ personalData.firstName }} {{ personalData.lastName }}</p>
                                    <p><strong>Email:</strong> {{ personalData.email }}</p>
                                    <p><strong>Teléfono:</strong> {{ personalData.phone }}</p>
                                    <p><strong>Documento:</strong> {{ personalData.document }}</p>
                                </div>
                            </div>
                            
                            <div class="alert alert-info mt-4">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Importante:</strong> 
                                <ul class="mb-0 mt-2">
                                    <li><strong>QR de Entrada:</strong> Escanea rápidamente en la entrada del evento</li>
                                    <li><strong>QR Completo:</strong> Contiene todos tus datos para verificación</li>
                                    <li><strong>Código Manual:</strong> {{ ticketCode }} (por si falla el escáner)</li>
                                </ul>
                                <small class="text-muted">También hemos enviado una copia a tu email.</small>
                            </div>

                            <div class="mt-4">
                                <button class="btn btn-primary me-3" @click="downloadTicket()">
                                    <i class="fas fa-download me-2"></i>Descargar Entrada
                                </button>
                                <button class="btn btn-outline-success me-3" @click="retryGenerateQR()">
                                    <i class="fas fa-sync-alt me-2"></i>Regenerar QR
                                </button>
                                <button class="btn btn-outline-primary" @click="startOver()">
                                    <i class="fas fa-plus me-2"></i>Comprar Otra Entrada
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="src/main.js"></script>
</body>
</html>